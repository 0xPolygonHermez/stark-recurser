<%  let prefix_ = prefix ? `${prefix}_` : ""; -%>

<%  let circuitType = vadcopInfo.aggTypes.length ? starkInfo.airId + 2 : starkInfo.airId + 1; -%>
    circuitType <== <%- circuitType %>;

<%  if(vadcopInfo.aggTypes[starkInfo.subproofId].length  > 0) { -%>
        aggregationTypes <== [<%- vadcopInfo.aggTypes[starkInfo.subproofId].map(a => a.aggType).join(",") %>];
<%      for (let i = 0; i < vadcopInfo.aggTypes[starkInfo.subproofId].length; ++i) { -%>
    subproofValues[<%- i %>] <== <%- prefix_ %>subproofValues[<%- i %>];
<%      } -%>
<%  } -%>

<%  for (let i = 0; i < starkInfo.nStages; ++i) { -%>
    root<%- i+1 %> <== <%- prefix_ %>root<%- i+1 %>;
<%  } -%>
<%  for (let i = starkInfo.nStages; i < vadcopInfo.numChallenges.length; ++i) { -%>
    root<%- i+1 %> <== [0,0,0,0];
<%  } -%>

    root<%- starkInfo.nStages + 1 %> <== <%- prefix_ %>root<%- starkInfo.nStages + 1 %>;

    evalsHash <== CalculateEvalsHash()(<%- prefix_ %>evals);

<%  let friCounter = 1; -%>
<%  for(let i = 1; i < vadcopInfo.stepsFRI.length; i++) { -%>
<%     if(friCounter < starkInfo.starkStruct.steps.length && starkInfo.starkStruct.steps[friCounter].nBits === vadcopInfo.stepsFRI[i - 1].nBits) { -%>
    s<%- i %>_root <== <%- prefix_ %>s<%- ++friCounter %>_root;
<%     } else { -%>
    s<%- i %>_root <== [0,0,0,0];
<%     } -%>
<%  } -%>
    
    finalPolHash <== CalculateFinalPolHash()(<%- prefix_ %>finalPol);

<%  let c = 0; -%>
<%  for(let i = 0; i < vadcopInfo.numChallenges.length; ++i) { -%>
<%      for(let j = 0; j < vadcopInfo.numChallenges[i]; ++j) { -%>
<%          if(i < starkInfo.nStages && j < starkInfo.challengesMap.filter(c => c.stage == i + 1).length) { -%>
    <%- componentName %>.challengesStage<%- i + 1 %>[<%-j %>] <== challenges[<%- c++ %>];
<%          } else { -%>
<%                c++; -%>
<%          } -%>
<%      } -%>
<%  } -%>

    <%- componentName %>.challengeQ <== challenges[<%- c++ %>];
    <%- componentName %>.challengeXi <== challenges[<%- c++ %>];
    <%- componentName %>.challengesFRI[0] <== challenges[<%- c++ %>];
    <%- componentName %>.challengesFRI[1] <== challenges[<%- c++  %>];

<%  c = 0; %>
<%  for(let i = 0; i < vadcopInfo.stepsFRI.length; ++i) { -%>
<%      if(c < starkInfo.starkStruct.steps.length && starkInfo.starkStruct.steps[c].nBits === vadcopInfo.stepsFRI[i].nBits) { -%>
    <%- componentName %>.challengesFRISteps[<%- c++ %>] <== challengesFRISteps[<%- i %>];
<%      } -%>
<%  } -%>
    <%- componentName %>.challengesFRISteps[<%- starkInfo.starkStruct.steps.length %>] <== challengesFRISteps[<%- vadcopInfo.stepsFRI.length %>];
    
    