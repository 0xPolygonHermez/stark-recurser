pragma circom 2.1.0;
pragma custom_templates;

<% if(vadcopInfo.aggTypes.length > 1) { -%>
include "vadcop/helpers/nullable/select_vk.circom";
include "vadcop/helpers/nullable/agg_values.circom";
<% } else { -%>
include "vadcop/helpers/select_vk.circom";
include "vadcop/helpers/agg_values.circom";
<% } -%>

<% for (let i = 0; i < verifierFilenames.length; ++i) { -%>
    include "<%- verifierFilenames[i] %>";
<% } -%>


template Main() {
    signal input publics[<%- starkInfo.nPublics %>];

    signal input challenges[<%- vadcopInfo.numChallenges.reduce((nc, acc) => nc + acc, 0) + 4 %>][3];
    signal input challengesFRISteps[<%- vadcopInfo.stepsFRI.length + 1%>][3];

    signal input rootCBasics[<%- vadcopInfo.nAirs[starkInfo.subproofId] %>][4];
    signal input rootCAgg[4];

<%- include('src/main_templates/define_stark_inputs.circom.ejs', { prefix: "a", starkInfo, nPublics: starkInfo.nPublics }); %>
<%- include('src/main_templates/define_stark_inputs.circom.ejs', { prefix: "b", starkInfo, nPublics: starkInfo.nPublics }); %>
   
<%- include('src/main_templates/vadcop/define_vadcop_inputs.circom.ejs', { prefix: "a", vadcopInfo, starkInfo, options }); %>
<%- include('src/main_templates/vadcop/define_vadcop_inputs.circom.ejs', { prefix: "b", vadcopInfo, starkInfo, options }); %>

<%- include('src/main_templates/assign_stark_inputs.circom.ejs', { componentName: "vA", prefix: "a", starkInfo, nPublics: starkInfo.nPublics }); %>
<%- include('src/main_templates/assign_stark_inputs.circom.ejs', { componentName: "vB", prefix: "b", starkInfo, nPublics: starkInfo.nPublics }); %>

<%- include('src/main_templates/vadcop/assign_vadcop_inputs.circom.ejs', { componentName: "vA", vadcopInfo, prefix: "a" }); %>
<%- include('src/main_templates/vadcop/assign_vadcop_inputs.circom.ejs', { componentName: "vB", vadcopInfo, prefix: "b" }); %>

    vA.rootC <== SelectVerificationKey()(a_circuitType, rootCBasics, rootCAgg);
    vB.rootC <== SelectVerificationKey()(b_circuitType, rootCBasics, rootCAgg);

<%- include('src/main_templates/vadcop/agg_vadcop_inputs.circom.ejs', { vadcopInfo, prefix1: "a", prefix2: "b" }); %>

}

component main {public [publics, challenges, challengesFRISteps, rootCAgg]} = Main();
